@startuml
' Diagrama 05 - Editar paciente
' Usuario actualiza datos de un paciente existente
title 05 - Editar paciente

actor Doctor
participant "Sistema Web" as Web
participant "Servidor (API REST)" as Server
database "PostgreSQL (Neon)" as DB

Doctor -> Web : Abre perfil_paciente.html y edita datos
Web -> Server : PUT /api/pacientes/{id}\n{ nombre, apellido, dni, telefono, email, fecha_nacimiento }

Server -> DB : SELECT * FROM pacientes\nWHERE id = $1 AND id_usuario = $2
DB --> Server : registro_paciente

alt paciente existe para este id_usuario
  Server -> DB : UPDATE pacientes\n  SET nombre = $1, apellido = $2, dni = $3,\n      telefono = $4, email = $5, fecha_nacimiento = $6\n  WHERE id = $7 AND id_usuario = $8
  DB --> Server : OK
  
  Server --> Web : HTTP 200 OK\n{ mensaje: "Paciente actualizado" }
  Web --> Doctor : Muestra confirmación
  
else paciente no existe
  Server --> Web : HTTP 404 Not Found\n{ error: "Paciente no encontrado" }
  Web --> Doctor : Muestra error
end

note over Server, DB
  **Seguridad**: Solo se actualizan pacientes del mismo `id_usuario` (aislamiento por usuario)
  **Validación**: DNI debe seguir siendo único por `id_usuario`
end note

@enduml

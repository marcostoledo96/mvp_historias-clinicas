@startuml
' Diagrama 09 - Editar consulta
' Modificar una entrada existente en la historia clínica
title 09 - Editar consulta

actor Doctor
participant "Sistema Web" as Web
participant "Servidor (API REST)" as Server
database "PostgreSQL (Neon)" as DB

Doctor -> Web : Abre consulta existente en consulta.html\ny modifica datos

Web -> Server : PUT /api/consultas/{id}\n{ fecha, motivo, diagnostico,\n  prescripciones, estudios, observaciones }

Server -> DB : SELECT c.* FROM consultas c\n  INNER JOIN pacientes p ON c.id_paciente = p.id\n  WHERE c.id = $1 AND p.tenant_id = $2
DB --> Server : consulta_existente

alt consulta existe en este tenant
  Server -> DB : UPDATE consultas\n  SET fecha = $1, motivo = $2, diagnostico = $3,\n      prescripciones = $4, estudios = $5, observaciones = $6\n  WHERE id = $7
  DB --> Server : OK
  
  Server --> Web : HTTP 200 OK\n{ mensaje: "Consulta actualizada" }
  Web --> Doctor : Muestra confirmación
  
else consulta no existe o no autorizado
  Server --> Web : HTTP 404 Not Found\n{ error: "Consulta no encontrada" }
  Web --> Doctor : Muestra error
end

note over Server, DB
  **Seguridad**: Solo se editan consultas del mismo tenant (vía JOIN)
  **Auditoría**: Se podría agregar campo updated_at para tracking
end note

@enduml

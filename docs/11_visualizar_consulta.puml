@startuml
' Diagrama 11 - Visualizar consulta
' Ver detalles de una entrada específica de la historia clínica
title 11 - Visualizar consulta

actor Doctor
participant "Sistema Web" as Web
participant "Servidor (API REST)" as Server
database "PostgreSQL (Neon)" as DB

Doctor -> Web : Clic en consulta desde perfil del paciente

Web -> Server : GET /api/consultas/{id}

Server -> DB : SELECT c.*, p.nombre, p.apellido\n  FROM consultas c\n  INNER JOIN pacientes p ON c.id_paciente = p.id\n  WHERE c.id = $1 AND p.tenant_id = $2
DB --> Server : datos_consulta + datos_paciente

alt consulta existe en este tenant
  Server --> Web : HTTP 200 OK\n{ consulta: {\n    id, fecha, motivo, diagnostico,\n    prescripciones, estudios, observaciones,\n    paciente: { nombre, apellido }\n  }\n}
  Web --> Doctor : Muestra consulta.html con todos los detalles
  
else consulta no existe o no autorizado
  Server --> Web : HTTP 404 Not Found\n{ error: "Consulta no encontrada" }
  Web --> Doctor : Redirige o muestra error
end

note over Server, DB
  **Vista completa**: Todos los campos de la consulta + datos del paciente
  **Seguridad**: Solo consultas del mismo tenant (via JOIN)
  **Navegación**: Permite editar o borrar desde esta vista
end note

@enduml

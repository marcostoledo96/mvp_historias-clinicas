<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuración - Sistema de Historias Clínicas</title>
  <link rel="icon" href="img/historial.ico" sizes="any">
  <link rel="icon" type="image/png" href="img/historial.png">
  <link rel="stylesheet" href="css/styles.css" />
  <!--
    ! Página: Configuración
    * Propósito: actualizar datos del perfil, cambiar contraseña y preferencias locales
    * Scripts: utils.js, auth.js, components.js, configuracion.js
    ? Requiere sesión activa; accede a /api/auth/perfil y /api/auth/password
  -->
</head>
<body>
  <div class="main-layout">
    <div id="header-container"></div>

    <main class="content">
      <div id="alert-container"></div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title page-title"><span class="material-symbols-outlined" aria-hidden="true">settings</span> Configuración de la cuenta</h2>
          <p class="text-gray-600">Actualiza tus datos personales y preferencias</p>
        </div>
        <div class="card-body">
          <form id="form-perfil">
            <div class="form-row">
              <div class="form-group w-full">
                <label class="form-label">Nombre completo</label>
                <input name="nombre" class="form-input" required />
              </div>
              <div class="form-group w-full">
                <label class="form-label">Email</label>
                <input name="email" type="email" class="form-input" required />
              </div>
            </div>
            <div class="card-footer">
              <button type="submit" id="btn-guardar-perfil" class="btn btn-primary btn-field"><span class="material-symbols-outlined" aria-hidden="true">save</span> Guardar cambios</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-header">
          <h3 class="card-title section-title"><span class="material-symbols-outlined" aria-hidden="true">lock</span> Cambiar contraseña</h3>
        </div>
        <div class="card-body">
          <form id="form-password">
            <div class="form-row">
              <div class="form-group w-full">
                <label class="form-label">Contraseña actual</label>
                <input name="password_actual" type="password" class="form-input" required />
              </div>
              <div class="form-group w-full">
                <label class="form-label">Nueva contraseña</label>
                <input name="password_nueva" type="password" class="form-input" required />
              </div>
            </div>
            <div class="card-footer">
              <button type="submit" id="btn-guardar-password" class="btn btn-secondary btn-field"><span class="material-symbols-outlined" aria-hidden="true">key</span> Actualizar contraseña</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-header">
          <h3 class="card-title section-title"><span class="material-symbols-outlined" aria-hidden="true">help</span> Pregunta secreta</h3>
          <p class="text-gray-600">Configurá tu pregunta para recuperar contraseña</p>
        </div>
        <div class="card-body">
          <div id="pregunta-actual-container" class="mb-3 hidden">
            <div style="background:#f0f9ff; padding:12px; border-radius:6px; border-left:3px solid #3b82f6">
              <p style="margin:0; color:#1e40af; font-weight:500">Pregunta configurada:</p>
              <p id="pregunta-actual-texto" style="margin:4px 0 0 0; color:#1e3a8a"></p>
            </div>
          </div>
          <form id="form-pregunta-secreta">
            <div class="form-row">
              <div class="form-group w-full">
                <label class="form-label">Pregunta secreta</label>
                <input name="pregunta" class="form-input" placeholder="Ej: ¿Nombre de tu primera mascota?" required />
                <small style="color:#666">Elegí una pregunta que solo vos puedas responder</small>
              </div>
              <div class="form-group w-full">
                <label class="form-label">Respuesta</label>
                <input name="respuesta" type="password" class="form-input" placeholder="Tu respuesta secreta" required />
                <small style="color:#666">La respuesta se guarda encriptada como tu contraseña</small>
              </div>
            </div>
            <div class="card-footer">
              <button type="submit" id="btn-guardar-pregunta" class="btn btn-success btn-field"><span class="material-symbols-outlined" aria-hidden="true">shield</span> Guardar pregunta secreta</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Sección de preferencias eliminada para el MVP -->

      <div id="card-admin" class="card mt-4 hidden">
        <div class="card-header">
          <h3 class="card-title section-title"><span class="material-symbols-outlined" aria-hidden="true">admin_panel_settings</span> Administración</h3>
          <p class="text-gray-600">Crear nuevos usuarios (solo administradores)</p>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <button id="btn-mostrar-crear-usuario" class="btn btn-success btn-field" type="button"><span class="material-symbols-outlined" aria-hidden="true">person_add</span> Crear usuario</button>
          </div>
          <form id="form-crear-usuario-config" class="hidden">
            <div class="form-row">
              <div class="form-group w-full">
                <label class="form-label">Nombre completo</label>
                <input name="nombre_completo" class="form-input" required />
              </div>
              <div class="form-group w-full">
                <label class="form-label">Email</label>
                <input name="email" type="email" class="form-input" required />
              </div>
              <div class="form-group w-full">
                <label class="form-label">Contraseña</label>
                <input name="password" type="password" class="form-input" required />
              </div>
              <div class="form-group">
                <label class="form-label">Rol</label>
                <select name="rol" class="form-select">
                  <option value="doctor">Doctor</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
            </div>
            <div class="card-footer">
              <button type="button" id="btn-cancelar-crear-usuario" class="btn btn-secondary btn-field">Cancelar</button>
              <button type="submit" id="btn-crear-usuario" class="btn btn-primary btn-field">Guardar usuario</button>
            </div>
          </form>
        </div>
      </div>

    </main>

    <div id="footer-container"></div>
  </div>

  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/components.js"></script>
  <script src="js/configuracion.js"></script>
</body>
</html>
